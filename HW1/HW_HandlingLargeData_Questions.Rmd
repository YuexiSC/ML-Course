---
title: 'HW on Handling Large Datasets: Questions'
output: html_document
---

Turn in your HW on this Rmarkdown file. Add your names here at the top. Your answers should be neatly arranged in blocks of code below; insert code blocks as needed. Use the markdown language to add any text you need to explain your homework. 

##Getting and Handling Large Data Sets
```{r}
load("MDHtickers.RData")
setwd("/Users/liyuexi/Documents/Project/Homework/HW2")
```
####GET THE DATA

You will acquire and analyze a real dataset on baby name popularity provided by the Social Security Administration. To warm up, we will ask you a few simple questions that can be answered by inspecting the data.

The data can be downloaded in zip format from:
http://www.ssa.gov/oact/babynames/state/namesbystate.zip  (~22MB)

#### QUESTION 1
Please describe the format of the data files. Can you identify any limitations or distortions of the data.

First, download the zip file and unzip it to grab the contents. You will see lots of different files. Store them in a directory called "namesbystate". Then we write R code to read those files and put them together. 
```{r}
library(data.table)
library(magrittr)

setwd("/Users/liyuexi/Documents/Project/Homework/HW2/namesbystate/")
getwd()

file_list <- list.files(path='/Users/liyuexi/Documents/Project/Homework/HW2/namesbystate/') 
dataset <- do.call("rbind", lapply(file_list, FUN=function(files) {read.table(paste('namesbystate/',files,sep=""), header=FALSE, sep=",")} 
))
colnames(dataset)<- cbind('state','sex','birth_year','name','x')

sample(dataset)
```

#### QUESTION 2
What is the most popular name of all time across both genders? 
```{r}
library(plyr)
unique(dataset$sex)
F_set<-dataset[dataset$sex=='F',]
M_set<-dataset[dataset$sex=='M',]

female_name<- as.data.frame(count(F_set,"name")) %>% print
f_name<-female_name[female_name$freq==max(female_name$freq),] %>% print

male_name<- as.data.frame(count(M_set,"name"))
m_name<-male_name[male_name$freq==max(male_name$freq),] %>% print
```

Female: Elizabeth
Male: John, William

#### QUESTION 3
What is the most gender ambiguous name in 2013? 1945? (you need to come up with an ambiguity metric, so think about how you may want to implement this. You may of course search for definitions of ambiguity.)
```{r}
library(dplyr)
library(plyr)
set_2013<-dataset[dataset$birth_year==2013,]
set_2013_F<-set_2013[set_2013$sex=='F',] 
set_2013_M<-set_2013[set_2013$sex=='M',]
f_name_2013<- as.data.frame(count(set_2013_F,name))
m_name_2013<- as.data.frame(count(set_2013_M,name))
name_inner_2013<- merge(f_name_2013, m_name_2013, by='name')
name_inner_2013$total<-name_inner_2013$n.x+name_inner_2013$n.y
colnames(name_inner_2013)<- c('name','female_count','male_count','total_count')
name_inner_2013[order(name_inner_2013$total_count,decreasing = TRUE),][1,] %>% print

set_1945<-dataset[dataset$birth_year==1945,]
set_1945_F<-set_1945[set_1945$sex=='F',] 
set_1945_M<-set_1945[set_1945$sex=='M',]
f_name_1945<- as.data.frame(count(set_1945_F,name))
m_name_1945<- as.data.frame(count(set_1945_M,name))
name_inner_1945<- merge(f_name_1945, m_name_1945, by='name')
name_inner_1945$total<-name_inner_1945$n.x+name_inner_1945$n.y
colnames(name_inner_1945)<- c('name','female_count','male_count','total_count')
name_inner_1945[order(name_inner_1945$total_count,decreasing = TRUE),][1,] %>% print

```
Answer:
ambiguous name in 2013：Riley
ambiguous name in 1945：Leslie

#### QUESTION 4
Of the names represented in the data, find the name that has had the largest percentage increase in popularity since 1980. Largest decrease?

```{r}
data_1980<- data.table (dataset[dataset$birth_year==1980,])
data_1981<- data.table (dataset[dataset$birth_year==1981,])

data_1980$count<- 1
setkey(data_1980,name)
data_1980<- data_1980[,sum(count),by=name]

data_1981$count<- 1
setkey(data_1981,name)
data_1981<-data_1981[,sum(count),by=name]

data_all<- merge(data_1980,data_1981,by='name',all=TRUE)
colnames(data_all)<- c('name','num_1980','num_1981')

data_all$change<- ((data_all$num_1981-data_all$num_1980)*1.0/data_all$num_1980)
data_all_sorted<- arrange(data_all, data_all$change)
data_all_sorted<-filter(data_all_sorted,is.na(num_1980)==FALSE, is.na(num_1981)==FALSE)

largest_increase<- data_all_sorted[data_all_sorted$change== max(data_all_sorted$change),] %>% print
largest_decrease<- data_all_sorted[data_all_sorted$change== min(data_all_sorted$change),] %>% print

```
Answers:
Largest percentage of increase: Krystle
Largest percentage of decrease: Melany//Ranada


#### QUESTION 5
Can you identify names that may have had an even larger increase or decrease in popularity? (This requires you to consider every year as the start year and find the greatest increase/descrease across all years. Print out the top name for growth from each year.)
```{r}
library(zoo)
rollapply(dataset,FUN=roll_fun(dataset),width=1) 
roll_fun<- function(dataset) {
}

```

This gives interesting results, and may be used in a different way with a rolling window than using all the data. 

#### QUESTION 6

What insight can you extract from this dataset? Feel free to combine the baby names data with other publicly available datasets or APIs, but be sure to include code for accessing any alternative data that you use.

This is an open-ended question and you are free to answer as you see fit. In fact, it would be great if you find a way to look at the data that is highly interesting.
```{r}


```

#### QUESTION 7

Go to the airlines data site: 
http://stat-computing.org/dataexpo/2009/the-data.html. 
Read in the airlines data set for 2008 into a data frame.
How many rows of data do you have?
```{r}
airlines<- fread("2008.csv",header=TRUE) %>% dim
dim(airlines)
```
Answers:
7009728 rows total

#### QUESTION 8

Remove all rows of the data frame with missing data. How many rows of data do you have now?
```{r}
idx1 = which(rowSums(is.na(airlines))==0)
airlines_na = airlines[idx1,] 
sample(airlines_na)
``` 
Answer:
Has 1524735 rows

#### QUESTION 9

Fit one regression model each to explain "DepDelay" and "ArrDelay". Use your judgment as to which variables you might use to explain these outcomes. Use a subset of 1 million rows of the data you created with no missing data. Keep the remaining data for out-of-sample testing. (**Remember to factor all categorical variables.**)
```{r}
library(caret)
library(lattice)
library(ggplot2)
library(data.table)
colnames(airlines_na)
data(airlines_na)
inTrain <- createDataPartition(y=airlines_na$ArrDelay, p=0.7, list=F) 
train_airlines<- airlines_na[inTrain, ] 
test_airlines<- airlines_na[-inTrain, ]
colnames(airlines_na)
#get character of the columns
char_col<- filter(data.table(v1=colnames(airlines_na),v2=sapply(as.data.table(airlines_na),class) ), v2=="character") %>% print

unique(airlines_na$UniqueCarrier)
unique(airlines_na$TailNum)
unique(airlines_na$Origin)
unique(airlines_na$Dest)
unique(airlines_na$CancellationCode)




```
#### QUESTION 10

Now take the fitted regression and predict delays using the remaining data from the no-missing data set (this is the data you did not use in the fitting the model). Compare this to the actual delays and report the absolute mean error in your prediction. 
```{r}


```

